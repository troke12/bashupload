<?php

$uploads = $uploads ?? [];
$error = $error ?? null;
$res = [];
$scheme = $_SERVER['REQUEST_SCHEME'] ?? ((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? 'https' : 'http');
$host = HOST ?: ($_SERVER['HTTP_HOST'] ?? 'localhost');

foreach ( $uploads as $file ) {
	$key = $file['upload_name'] ?? uniqid();
	$res[$key] = [
		'url' => $scheme . '://' . $host . '/' . $file['id'] . '/' . $file['name'],
		'size' => number_format($file['size'], 0, '.', ' ')
	];
}

if ( $error ) {
	$res['error'] = $error;
} elseif ( empty($res) ) {
	$res['status'] = 'no_files';
}

echo json_encode($res);